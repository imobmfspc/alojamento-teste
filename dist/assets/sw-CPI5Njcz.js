const n="alojamento-local-v1",c=["/","/index.html","/manifest.json","/alojamento-favicon.png","/alojamento-app.png"];self.addEventListener("install",e=>{console.log("Service Worker: Installing..."),e.waitUntil(caches.open(n).then(t=>(console.log("Service Worker: Caching static assets"),t.addAll(c))).then(()=>(console.log("Service Worker: Installation complete"),self.skipWaiting())).catch(t=>{console.error("Service Worker: Installation failed",t)}))});self.addEventListener("activate",e=>{console.log("Service Worker: Activating..."),e.waitUntil(caches.keys().then(t=>Promise.all(t.map(o=>{if(o!==n)return console.log("Service Worker: Deleting old cache",o),caches.delete(o)}))).then(()=>(console.log("Service Worker: Activation complete"),self.clients.claim())))});self.addEventListener("fetch",e=>{e.request.method==="GET"&&e.request.url.startsWith(self.location.origin)&&e.respondWith(caches.match(e.request).then(t=>t||fetch(e.request).then(o=>{if(!o||o.status!==200||o.type!=="basic")return o;const i=o.clone();return caches.open(n).then(a=>{a.put(e.request,i)}),o}).catch(o=>{if(console.error("Service Worker: Fetch failed",o),e.request.destination==="document")return caches.match("/");throw o})))});self.addEventListener("sync",e=>{e.tag==="background-sync"&&(console.log("Service Worker: Background sync triggered"),e.waitUntil(r()))});async function r(){console.log("Service Worker: Performing background sync")}self.addEventListener("push",e=>{console.log("Service Worker: Push notification received");const t={body:e.data?e.data.text():"Nova notificação do Alojamento Local",icon:"/alojamento-app.png",badge:"/alojamento-favicon.png",vibrate:[100,50,100],data:{dateOfArrival:Date.now(),primaryKey:1},actions:[{action:"explore",title:"Ver Detalhes",icon:"/alojamento-app.png"},{action:"close",title:"Fechar",icon:"/alojamento-app.png"}]};e.waitUntil(self.registration.showNotification("Alojamento Local",t))});self.addEventListener("notificationclick",e=>{console.log("Service Worker: Notification clicked"),e.notification.close(),e.action==="explore"&&e.waitUntil(clients.openWindow("/"))});
